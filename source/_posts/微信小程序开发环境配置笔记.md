---
title: 微信小程序开发环境配置笔记
date: 2017-01-17 10:22:24
tags:
  - nginx
  - https
categories:
  - 小程序
---

<center>微信小程序开发环境配置, Nginx需要开启https, 申请ssl证书</center>
<!-- more -->

1. 调试时可以直接用内网
http://ip:port/api/a/b?args={}&sig=xxxx
进行联网

2. 开发时小程序后台配置
项目-开发环境不校验请求域以及TLS版本 去掉勾选不验证域名

3. 上传时，需要在微信小程序后台，设置，开发设置添加校验域名，
注意:不要带www，例如 https://wjdc.xxx.com

4. 服务器需要搭建https环境

    1. nginx开启https
命令行 nginx -V 查看nginx是否开启了--with-http_ssl_module选项，如果没有，需要重新编译带上此选项
    2. 申请ssl证书
去阿里云申请ssl证书，有免费试用一年的。
服务器是阿里云的，推荐DNS类证书，注意对应域名不要带www，例如wjdc.xxx.com，否则会提示服务器被冒充，勾选自动创建主机记录和记录值，审核完毕后下载证书，解压到nginx.conf同级的cert目录下
然后修改nginx.conf
```text
    server {
        listen 443;
        server_name wjdc.knightflower.com;

        charset utf-8;
        access_log  /data/wjdc/logs/https_access.log  main;

        ssl on;
        ssl_certificate   cert/xxx.pem;
        ssl_certificate_key  cert/xxx.key;
        ssl_session_timeout 5m;
        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
        ssl_prefer_server_ciphers on;

        location / {
            try_files /_not_exists_ @backend;
        }

        location @backend {
            proxy_set_header X-Forwarded-For $remote_addr;
            proxy_set_header Host            $http_host;

            proxy_pass http://127.0.0.1:6066;
        }
    }
```

```bash
nginx -t -c /etc/nginx/nginx.conf #校验配置文件是否有错
nginx -s reload #重新加载配置文件
```
然后就可以在小程序里面用wx.request接口请求服务器，url:"https://wjdc.xxx.com/a/q/query"